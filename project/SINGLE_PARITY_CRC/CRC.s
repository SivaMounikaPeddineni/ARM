 AREA     appcode, CODE, READONLY
     EXPORT __main
	 IMPORT printMsg
     ENTRY 
__main  FUNCTION
;GENERATOR POLYNOMIAL IS G(x) = x4 + x + 1 IS ENCODED AS 10011
;LETS CONSIDER INPUT BIT SEQUENCE AS 1101011011 
;FINAL RESULT MESSAGE IS PRINTED IN PRINTVIEW WINDOW

	LDR R1,= 0x00002600 ; GENERATOR POLYNOMIAL LOADED
	LDR R2,= 0x0000035B ; CODE TO BE TRANSMITTED IS LOADED IN R2
	LDR R3,= 0x00002000
	LDR R10,= 0x00000000 ; USED FOR COMPARISON
	LDR R11,= 0x00000010 ; USED FOR COMPARISON
	LDR R9,= 0x00000001 ; USED FOR COMPARISON
	LSL R4,R2,#4 ; DIVIDENT VALUE IS STORED IN R4
	MOV R6,R4
	LDR R12,= 0x00001001 ; RECEIVED CODE IS STORED IN R12
	
LOOP1
	AND R5,R4,R3 ; TO DETECT WHETHER MSB BIT IS 1 OR 0
	LSR R3,#1	
	CMP R5,R10 ; IF R5=1 THEN XOR OPERATION IS PERFORMED, ELSE NOTHING IS DONE
	BNE LOOP ; IN THIS LOOP XOR OPEARATION IS DONE
	LSR R1,#1 ;GENERATOR POLYNOMIAL SHIFTED RIGHT BY 1 BIT
	CMP R3,R11   	
	BNE LOOP1
	BEQ SENDER
	
LOOP
	EOR R4,R4,R1 ; XOR OF GENERATOR POLYNOMIAL AND INPUT SEQUENCE IS DONE
	LSR R1,#1
	CMP R3,R11
	BEQ SENDER
	B LOOP1
; AT THIS POINT CHECK R4 CONTENT. THIS HAS THE CRC CODE
SENDER
    CMP R8,R9 
	BEQ PRINT
	ORR R6,R6,R4 ; THIS IS FINAL CODE TO BE TRANSMITTED
	B RECEIVER ; RECEIVER BLOCK IS CALLED
	
RECEIVER
	;MOV R4,R12 ; UNCOMMENT THIS TO CHECK ERROR
	MOV R4,R6
	LDR R3,= 0x00002000
	LDR R1,= 0x00002600
	LDR R8,= 0x00000001
	B LOOP1
PRINT
	CMP R4,R10
    MOVNE R0,R9
	BL printMsg
stop    B stop ; stop program
        ENDFUNC
        END 